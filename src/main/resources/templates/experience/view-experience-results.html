<!DOCTYPE html>
<html lang="en">
<head>
    <div th:replace="~{fragments :: head}"></div>

    <script th:src="@{/js/view-experience-results.js}"
            src="../../static/js/view-experience-results.js"
            defer></script>
    <script th:src="@{https://maps.googleapis.com/maps/api/js(key=${gmapsApiKey}, loading='async', libraries='marker,places', callback='initGMapsApi')}"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuFGE39oMheD0Y3071eSpRdA8ib4F5OFw&loading=async&libraries=marker,places&callback=initGMapsApi"
            defer></script>

    <title>Results</title>

    <style>
        #searchForm input:focus, #searchForm select:focus {
            /* Bring to top when focused (z-axis) so box-shadow outline is fully visible*/
            position: relative;
        }

        @media (min-width: 992px) {
            #searchForm [name='distanceMiles'], #searchForm [name='keywords'] {
                border-radius: 0;
            }
        }
    </style>
</head>

<body>
<header th:replace="~{fragments :: header}"></header>
<main class="container">
    <form th:action="@{/experience/search}" th:object="${searchForm}" action="#" method="get"
          class="row gx-0 mx-auto justify-content-center" id="searchForm" novalidate>
        <div class="col-9 col-lg">
            <input th:value="*{locationText}" type="search" id="acLocationInput" placeholder="Location"
                   aria-label="Location" class="form-control mb-1 rounded-end-0" maxlength="1000">
        </div>
        <input th:value="*{locationText}" type="hidden" name="locationText">
        <input th:value="*{locationLat}" type="hidden" name="locationLat">
        <input th:value="*{locationLng}" type="hidden" name="locationLng">
        <div class="col-3 col-lg-auto">
            <select name="distanceMiles" aria-label="Distance" class="form-select rounded-start-0">
                <option value="1" th:selected="*{distanceMiles == 1}">1 mile</option>
                <option value="5" th:selected="*{distanceMiles == 5}">5 miles</option>
                <option value="25" th:selected="*{distanceMiles == 25}">25 miles</option>
                <option value="100" th:selected="*{distanceMiles == 100}">100 miles</option>
                <option value="500" th:selected="*{distanceMiles == 500}">500 miles</option>
            </select>
        </div>
        <!--
         Create full-width dummy div to force row to break at <lg screen sizes
         At lg+, set display = none to disable
         https://getbootstrap.com/docs/5.3/utilities/display/
         -->
        <div class="w-100 d-lg-none"></div>
        <div class="col-9 col-lg">
            <input th:value="*{keywords}" type="search" name="keywords" placeholder="Keywords" aria-label="Keywords"
                   class="form-control rounded-end-0" spellcheck="true" maxlength="100">
        </div>
        <div class="col-3 col-lg-auto">
            <button type="submit" class="btn btn-success w-100 rounded-start-0 m-0" style="white-space: nowrap">
                <i class="bi bi-search"></i> Search
            </button>
        </div>
    </form>

    <div class="row justify-content-between align-items-end my-4">
        <h1 class="col">Results â€”</h1>
        <div class="dropdown col-auto align-self-center">
            <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Sort By
            </button>
            <ul class="dropdown-menu">
                <li th:each="entry : ${sortByUrls}">
                    <a th:if="${entry.getValue() == null}" th:text="${entry.getKey()}"
                       class="dropdown-item active" href="javascript:;">
                        Sort 1 (Active)
                    </a>
                    <a th:if="${entry.getValue() != null}" th:href="@{${entry.getValue()}}" th:text="${entry.getKey()}"
                       class="dropdown-item" href="#">
                        Sort 2
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="row">
        <div th:each="experience : ${searchResult.experiences}" class="col d-flex align-items-stretch mb-5">
            <!-- <div th:text="${experience.experienceId}" class="col-auto">1</div>
            
            <a th:href="@{/experience/{experienceId}(experienceId=${experience.experienceId})}"
            href="view-experience.html" class="col-auto">
                <div th:text="${experience.title}" class="col-auto">Experience title</div>
            </a> -->
                <div class="card" style="width: 18rem;">
                    <img class="card-img-top" th:src="${experience.imageUrl} ?: @{/images/default-experience.png}"
                    th:onerror="|this.src='@{/images/default-experience.png}'; this.onerror='';|" 
                    alt="Experience Photo">
                    <div class="card-body">
                        <a th:href="@{/experience/{experienceId}(experienceId=${experience.experienceId})}"
                        href="view-experience.html" class="col-auto">
                            <h5 th:text="${experience.title}" class="card-title">Experience Title</h5>
                        </a>
                        <p class="card-text" th:text="${#strings.abbreviate(experience.description, 150)}">Experience text</p>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <i class="bi bi-calendar-date"></i>
                            <span th:text="${#temporals.format(experience.eventDate)}">January 1, 2025</span>
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-star"></i>
                            <span th:if="${experience.ratingCnt == 0}">No ratings</span>
                            <span th:if="${experience.ratingCnt > 0}" th:text="${rating}">4.67 / 5.0</span>
                            <span th:if="${experience.ratingCnt == 1}" style="font-size: 0.75rem"> (1 rating)</span>
                            <span th:if="${experience.ratingCnt > 1}" style="font-size: 0.75rem"
                                  th:text="${' (' + experience.ratingCnt + ' ratings)'}"> (5 ratings)</span>
                        </li>
                    </ul>
                </div>
        </div>
    </div>

    <div th:if="${!searchResult.hasNext}" class="row text-center my-5">
        <h6>End of results</h6>
    </div>

    <nav aria-label="Pagination">
        <ul class="pagination justify-content-center">
            <li th:classappend="${prevPageUrl == null ? 'disabled' : ''}" class="page-item" style="min-width: 106px">
                <a th:href="${prevPageUrl}" class="page-link"><i class="bi bi-arrow-left-short"></i>Previous</a>
            </li>
            <li th:classappend="${nextPageUrl == null ? 'disabled' : ''}" class="page-item text-center" style="min-width: 106px">
                <a th:href="${nextPageUrl}" class="page-link">Next<i class="bi bi-arrow-right-short"></i></a>
            </li>
        </ul>
    </nav>
</main>


<footer th:replace="~{fragments :: footer}"></footer>
</body>

</html>
